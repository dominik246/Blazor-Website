@page "/algorithms"

@inject IJSRuntime JSRuntime;
@inject AlgorithmSelector Algorithm;
@inject IToastService Toast;
@using Blazored.Toast.Configuration
@using Microsoft.JSInterop;

<title>@Title</title>

<BlazoredToasts Position="ToastPosition.TopRight"
                Timeout="10"
                ShowProgressBar="true" />

<div>
    <div class="taskbar_div">
        <div>
            <button onclick="DropDownMenuFunc()" class="base_button algorithm">Algorithms</button>
            <div id="dropDownButton" class="dropdown-content">
                @foreach (string s in AlgorithmList)
                {
                    <a href="algorithms#@(s.ToSafeUrl())" @onclick="() => GetAlgorithm(s)">@s</a>
                }
            </div>
        </div>

        <button @onclick="() => Visualize()" class="base_button visualize">Visualize!</button>

        <div class="base_button clearGrid" @onclick="() => ClearGrid()">Clear Grid</div>

        <a class="base_button home" href="/">Home</a>

    </div>

    <div class="options_div">
        <input type="button" class="base_button start" @onclick="() => OptionsButton(Options[0])" value="Start" />
        <input type="button" class="base_button finish" @onclick="() => OptionsButton(Options[1])" value="Finish" />
        <input type="button" class="base_button wall" @onclick="() => OptionsButton(Options[2])" value="Wall" />
        <input type="button" class="base_button remove" @onclick="() => OptionsButton(Options[3])" value="Remove" />
        @*<input type="button" class="base_button checkpoint" @onclick="() => OptionsButton(Options[4])" />*@
    </div>

    <div class="grid_div">
        @for (int i = 0; i < 49; i++)
        {
            <div class="container_div">
                @for (int j = 0; j < 25; j++)
                {
                    <div class="grid_unit" id="@($"{j}, {i}")" onclick="UnitClicked(this)"></div>
                }
            </div>
        }
    </div>
</div>

@code {
    private string Title { get; set; } = "Shortest Path";

    private string AlgorithmName { get; set; } = "Dijkstra's Algorithm";

    private ElementReference reference;

    private List<string> AlgorithmList { get; set; } = new List<string>()
{
        "Dijkstra's Algorithm",
        "A* Algorithm",
        "Something Something",
        "Algorithm Algorithm"
    };

    private List<string> Options { get; set; } = new List<string>()
{
        "start",
        "finish",
        "wall",
        "remove",
        "checkpoint"
    };

    private async Task Visualize()
    {
        JsonElement grid = await JSRuntime.InvokeAsync<JsonElement>("GetGrid");

        int[][] result = await Algorithm.RunAsync(AlgorithmName, grid);
        await JSRuntime.InvokeVoidAsync("Visualize", new object[] { result });
    }

    private void GetAlgorithm(string s)
    {
        AlgorithmName = s;
    }

    private async Task ClearGrid()
    {
        string toastText = await JSRuntime.InvokeAsync<string>("ClearGrid");
        Toast.ShowInfo(toastText);
    }

    private async Task OptionsButton(string option)
    {
        string[] toastText = await JSRuntime.InvokeAsync<string[]>("OptionsButton", option);

        Toast.ShowSuccess(toastText[0]);
    }
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await Task.Run(() => Toast.ShowSuccess("Press Start button when you're ready.", "Welcome!"));
        }
    }
}
